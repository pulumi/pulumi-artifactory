# WARNING: This file is autogenerated - changes will be overwritten if not made via https://github.com/pulumi/ci-mgmt

env:
  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
jobs:
  update_bridge:
    name: upgrade-provider
    runs-on: ubuntu-latest
    steps:
    - name: Install Go
      uses: actions/setup-go@v3
      with:
        go-version: 1.20.1
    - name: Install pulumictl
      uses: jaxxstorm/action-install-gh-release@v1.5.0
      with:
        repo: pulumi/pulumictl
    - name: Install Pulumi CLI
      uses: pulumi/action-install-pulumi-cli@v2
    - env:
        GOPROXY: https://proxy.golang.org
      name: Download module dependencies
      run: go mod download
    - name: Setup Gradle
      uses: gradle/gradle-build-action@v2
      with:
        gradle-version: "7.6"
    - name: Checkout repo
      uses: actions/checkout@v3
      with:
        repository: pulumi/upgrade-provider
    - name: Set up git identity
      run: git config --global user.name "Pulumi Bot" && git config --global
        user.email "bot@pulumi.com"
    - env:
        GOPROXY: https://proxy.golang.org
      name: Make build
      run: make build
    - name: Run upgrade-provider
      run: ./upgrade-provider pulumi-artifactory --kind=all
    - env:
        SLACK_CHANNEL: provider-upgrade-status
        SLACK_COLOR: ${{ job.status }}
        SLACK_MESSAGE: |-
          Upgrade succeeded :heart_decoration: 
          PR opened at pulumi/${{ inputs.provider-name }}
        SLACK_TITLE: ${{ inputs.provider-name }} upgrade result
        SLACK_USERNAME: provider-bot
        SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}
      name: Notify success
      uses: rtCamp/action-slack-notify@v2
    - env:
        SLACK_CHANNEL: provider-upgrade-status
        SLACK_COLOR: ${{ job.status }}
        SLACK_MESSAGE: |-
          Upgrade succeeded :heart_decoration: 
          PR opened at pulumi/${{ inputs.provider-name }}
        SLACK_TITLE: ${{ inputs.provider-name }} upgrade result
        SLACK_USERNAME: provider-bot
        SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}
      if: ${{ failure() }}
      name: Notify success
      uses: rtCamp/action-slack-notify@v2
name: Upgrade provider
on:
  pull_request:
    types:
    - opened
